<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Ubuntu上的Git Server | OwenYang&#39;S IDEAS</title>
  <meta name="description" content="" />
  <meta name="keywords" content="blog, tech blog, code, personal opinion, OwenYang ideas" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" href="/css/moody.css" type="text/css">
  <meta name="generator" content="OwenYang'S IDEAS">

  
  
  

  
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?9f2d590e5f527b46e8628bd4322bd108";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">
      <header class="header">
    <div class="header__container">
        <a href="/" class="logo">OwenYang'S IDEAS</a>
        <nav class="header__nav">
            <ul class="header__nav-list">
                
                    <li class="nav-item">
                        <a class="icon-home"  href="/">Home</a>
                        </li>
                
                    <li class="nav-item">
                        <a class="icon-mail"  href="/about/">Contact</a>
                        </li>
                

            </ul>
        </nav>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <h1 class="post-title">Ubuntu上的Git Server</h1>
    <span class="post-meta">
      <time datetime="2014-12-24T12:48:00.000Z" itemprop="datePublished">
          Dec 24 2014
      </time>
    
    
    | 
    <a href='/tags/git/'>git</a>, 
    
    <a href='/tags/git-server/'>git server</a>, 
    
    <a href='/tags/gitolite/'>gitolite</a>, 
    
    <a href='/tags/ubuntu/'>ubuntu</a>
    
    
</span>
    <section class="post-content">
      <p>Git是一个开源的版本控制系统，由Linus Torvalds主导，用于支持Linux内核开发。每一个Git工作目录，都是一个完整的代码库，包含所有的提交历史。有能力跟踪所有的代码版本，而不会去依赖于网络与中央服务器。</p>
<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h3><p>Git可以通过以下的命令进行安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure></p>
<h3 id="u914D_u7F6E"><a href="#u914D_u7F6E" class="headerlink" title="配置"></a>配置</h3><p>每一个git的用户，在第一次使用的时候都需要通过以下两个命令，进行相应的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email <span class="string">"you@example.com"</span></span><br><span class="line">git config --global user.name <span class="string">"Your Name"</span></span><br></pre></td></tr></table></figure>
<h3 id="u57FA_u672C_u7528_u6CD5"><a href="#u57FA_u672C_u7528_u6CD5" class="headerlink" title="基本用法"></a>基本用法</h3><p>假设用户可以通过SSH的方式访问Server，对于用户想以分布式以及安全的方式使用Git，则已经完全足够了。在服务器端，创建一个新的仓库。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init --bare /path/to/repository</span><br></pre></td></tr></table></figure></p>
<p>这会创建一个裸仓库，它不允许我们直接编辑相应的文件。如果你需要在服务器端保留仓库内容的复本，去掉 –bare 选项就好了。</p>
<p>任何具有SSH权限的客户端，均可以克隆相应的仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone username@hostname:/path/to/repository</span><br></pre></td></tr></table></figure></p>
<p>一旦克隆到了客户端上，用户即可编辑相应的文件，然后提交得分享相应的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /path/to/repository # &#36827;&#20837;&#30446;&#24405;&#65292;&#32534;&#36753;&#10;git commit -a # &#25552;&#20132;&#25152;&#26377;&#20462;&#25913;&#21040;&#26412;&#22320;&#20179;&#24211;&#10;git push origin master # &#25512;&#36865;&#20462;&#25913;&#21040;&#26381;&#21153;&#22120;&#31471;&#30340;&#20179;&#24211;</span><br></pre></td></tr></table></figure></p>
<h3 id="u5B89_u88C5_gitolite_server"><a href="#u5B89_u88C5_gitolite_server" class="headerlink" title="安装 gitolite server"></a>安装 gitolite server</h3><p>虽然以上的那些，对于创建，克隆和修改仓库已经足够。但用户在服务器端安装git，最主要是想要一个传统的源代码控制管理服务器，具有多用户与权限管理的功能。推荐的解决方案是通过以下命令，安装 gitolite server：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gitolite</span><br></pre></td></tr></table></figure></p>
<h3 id="u914D_u7F6E_gitolite"><a href="#u914D_u7F6E_gitolite" class="headerlink" title="配置 gitolite"></a>配置 gitolite</h3><p>相比于大多数的类Unix系统，gitolite server的配置有一些小小的区别。传统的配置文件会存放在 /etc 的目录之下，而gitolite则把自己的配置文件放在一个git的仓库之中。配置一个新的gitolite的第一步，则需要有配置仓库的访问权限。<br>首先，让我们为gitolite创建一个用户，并具体其访问权限。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser --system --shell /bin/bash --group --disabled-password --home /home/git git</span><br></pre></td></tr></table></figure></p>
<p>现在我们想让gitolite知晓仓库管理员的SSH公钥。我们假设当前用户是仓库的管理员。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ~/.ssh/id_rsa.pub /tmp/$(whoami).pub</span><br></pre></td></tr></table></figure></p>
<p>我们切换到git用户，并将管理员的公钥导入gitolite。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo su - git&#10;gl-setup /tmp/*.pub</span><br></pre></td></tr></table></figure></p>
<p>Gitolite会允许在安装过程中，对配置文件做一些初期的修改。你现在可以通过管理员用户(即拥有管理员公钥的帐户)，克隆和修改gitolite的配置仓库。切回到管理员账号，克隆配置仓库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit&#10;git clone git@$IP_ADDRESS:gitolite-admin.git&#10;cd gitolite-admin</span><br></pre></td></tr></table></figure></p>
<p>gitolite-admin目录包含两个子目录，conf 和 keydir。配置文件存放在 conf目录，而keydir目录存放了用户的公钥信息。</p>
<h3 id="u7BA1_u7406gitolite_u5E10_u6237_u548C_u4ED3_u5E93"><a href="#u7BA1_u7406gitolite_u5E10_u6237_u548C_u4ED3_u5E93" class="headerlink" title="管理gitolite帐户和仓库"></a>管理gitolite帐户和仓库</h3><p>添加一个新的帐户到gitolite很简单：只需要获取用户的SSH公钥信息，以$DESIRED_USER_NAME.pub 的形式放在keydir目录之下即可。值得注意的是，gitolite的用户名不必和系统的用户名相匹配，它们仅仅是用在gitolite的配置文件之中，管理其访问权限的。同样的，删除用户只需要删除其对应的公钥文件即可。所有修改完毕之后，别忘了提交相应的修改，然后通过以下命令推回服务器端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -a&#10;git push origin master</span><br></pre></td></tr></table></figure></p>
<p>仓库是需要编辑conf/gitolite.conf文件进行管理。通过空格分割，遵守相应的权限规则，指定相应的仓库即可。以下是一些默认的示例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo    gitolite-admin&#10;        RW+     =   admin&#10;        R       =   alice&#10;repo    project1&#10;        RW+     =   alice&#10;        RW      =   bob&#10;        R       =   denise</span><br></pre></td></tr></table></figure>
<h3 id="u4F7F_u7528_u670D_u52A1_u5668"><a href="#u4F7F_u7528_u670D_u52A1_u5668" class="headerlink" title="使用服务器"></a>使用服务器</h3><p>要使用新创建的帐户，用户需要gitolite的管理员将其公钥导入到gitolite的配置仓库之中。然后，用户即可拥有相应的项目权限：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@$SERVER_IP:$PROJECT_NAME.git</span><br></pre></td></tr></table></figure></p>
<p>或者为一个已存在的git仓库添加一个远程地址：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add gitolite git@$SERVER_IP:$PROJECT_NAME.git</span><br></pre></td></tr></table></figure></p>
<p>如此便搭好了一个简易的，可用的git server。为了更好的查看相应的代码，或者管理，也可使用相对较重的，gitlab开源项目。</p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Owen Yang</h4>
    <p>摘一叶菩提，享一份宁静，敲一键淡然。</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?url=http://owenyang0.github.io/2014/12/24/Ubuntu上的Git-Server/&title=Ubuntu上的Git Server | OwenYang&#39;S" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://owenyang0.github.io/2014/12/24/Ubuntu上的Git-Server/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://owenyang0.github.io/2014/12/24/Ubuntu上的Git-Server/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://owenyang0.github.io/2014/12/24/Ubuntu上的Git-Server/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/2015/01/04/ECMAScript-6中的数组操作方法/">
        ← ECMAScript 6中的数组操作方法
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/2014/12/14/css-position-relative与display-table-cell深入分析/">
        css - position relative与display table-cell深入分析 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">OwenYang'S IDEAS</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="https://github.com/owenyang0/moody">moody</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-57882600-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>


<script type="text/javascript">
    var disqus_shortname = 'owenyang';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



    </div>
  </div>
</div>
</body>
</html>
